<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="800" height="900" viewBox="0 0 800 900">
<defs>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
        <feDropShadow dx="3" dy="3" stdDeviation="4" flood-opacity="0.12"/>
    </filter>
    
    <style>
        text { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; fill: #263238; }
        .title { font-size: 22px; font-weight: 800; fill: #fff; }
        .subtitle { font-size: 14px; fill: #eceff1; }
        .label { font-size: 13px; font-weight: 700; fill: #000; }
        .detail { font-size: 11px; fill: #455a64; }
        .code { font-family: 'Consolas', 'Courier New', monospace; font-size: 10px; fill: #0d47a1; }
        
        .box-step { fill: #ffffff; stroke: #455a64; stroke-width: 2; filter: url(#shadow); rx: 8; }
        .box-sensor { fill: #e3f2fd; stroke: #1565c0; stroke-width: 2; filter: url(#shadow); rx: 8; }
        .box-health { fill: #ffebee; stroke: #c62828; stroke-width: 2; filter: url(#shadow); }
        .box-output { fill: #e8f5e9; stroke: #2e7d32; stroke-width: 2; filter: url(#shadow); rx: 8; }
        
        .arrow { stroke: #546e7a; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
        .arrow-blue { stroke: #1565c0; stroke-width: 2; fill: none; marker-end: url(#arrowhead-blue); }
        
        .badge { fill: #263238; rx: 4; }
        .badge-text { font-size: 9px; font-weight: 700; fill: #fff; font-family: 'Consolas', monospace; }
    </style>
    
    <marker id="arrowhead" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
        <polygon points="0 0, 8 3, 0 6" fill="#546e7a"/>
    </marker>
    <marker id="arrowhead-blue" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
        <polygon points="0 0, 8 3, 0 6" fill="#1565c0"/>
    </marker>
</defs>

<!-- HEADER -->
<rect x="0" y="0" width="800" height="70" fill="#1565c0"/>
<text x="400" y="35" text-anchor="middle" class="title">SENSOR INPUT FLOW</text>
<text x="400" y="55" text-anchor="middle" class="subtitle">Capture • ISP • Health Check • Output</text>

<!-- STEP 1: CAPTURE -->
<g transform="translate(250, 100)">
    <rect x="0" y="0" width="300" height="80" class="box-sensor"/>
    <text x="150" y="25" text-anchor="middle" class="label" fill="#1565c0">1. FRAME CAPTURE</text>
    <text x="150" y="48" text-anchor="middle" class="code">IMX490 captures RAW Bayer</text>
    <text x="150" y="65" text-anchor="middle" class="detail">60 fps • HDR enabled</text>
</g>
<line x1="400" y1="180" x2="400" y2="210" class="arrow-blue"/>

<!-- STEP 2: ISP -->
<g transform="translate(250, 210)">
    <rect x="0" y="0" width="300" height="100" class="box-sensor"/>
    <text x="150" y="25" text-anchor="middle" class="label" fill="#1565c0">2. ISP PROCESSING</text>
    <text x="150" y="48" text-anchor="middle" class="code">Demosaic → Denoise → HDR</text>
    <text x="150" y="65" text-anchor="middle" class="code">White Balance → Gamma</text>
    <text x="150" y="82" text-anchor="middle" class="detail">On-chip, parallel (0ms added)</text>
</g>
<line x1="400" y1="310" x2="400" y2="340" class="arrow-blue"/>

<!-- STEP 3: DMA TRANSFER -->
<g transform="translate(250, 340)">
    <rect x="0" y="0" width="300" height="70" class="box-step"/>
    <text x="150" y="25" text-anchor="middle" class="label">3. DMA TRANSFER</text>
    <text x="150" y="48" text-anchor="middle" class="code">Camera → GPU Memory</text>
    <rect x="110" y="55" width="80" height="12" class="badge"/>
    <text x="150" y="64" text-anchor="middle" class="badge-text">~2 ms</text>
</g>
<line x1="400" y1="410" x2="400" y2="440" class="arrow"/>

<!-- STEP 4: HEALTH CHECK (DECISION) -->
<g transform="translate(250, 440)">
    <polygon points="150,0 300,50 150,100 0,50" fill="#ffebee" stroke="#d32f2f" stroke-width="2" filter="url(#shadow)"/>
    <text x="150" y="45" text-anchor="middle" class="label" fill="#d32f2f">4. HEALTH OK?</text>
    <text x="150" y="60" text-anchor="middle" class="detail" fill="#d32f2f">Thermal • FPS • Lens</text>
</g>

<!-- NO PATH: DEGRADED -->
<line x1="550" y1="490" x2="650" y2="490" class="arrow" style="stroke:#d32f2f"/>
<text x="600" y="480" class="detail" fill="#d32f2f">No</text>

<g transform="translate(650, 455)">
    <rect x="0" y="0" width="120" height="70" rx="6" fill="#ffebee" stroke="#d32f2f" stroke-width="2"/>
    <text x="60" y="25" text-anchor="middle" class="label" fill="#d32f2f">ALERT</text>
    <text x="60" y="45" text-anchor="middle" class="code" style="fill:#d32f2f">Log + Notify</text>
    <text x="60" y="58" text-anchor="middle" class="detail" fill="#d32f2f">health_status</text>
</g>

<!-- YES PATH: Continue -->
<line x1="400" y1="540" x2="400" y2="580" class="arrow"/>
<text x="415" y="560" class="detail" fill="#2e7d32">Yes</text>

<!-- STEP 5: PACK METADATA -->
<g transform="translate(250, 580)">
    <rect x="0" y="0" width="300" height="70" class="box-step"/>
    <text x="150" y="25" text-anchor="middle" class="label">5. PACK METADATA</text>
    <text x="150" y="48" text-anchor="middle" class="code">timestamp, exposure, gain, temp</text>
</g>
<line x1="400" y1="650" x2="400" y2="680" class="arrow"/>

<!-- STEP 6: OUTPUT -->
<g transform="translate(250, 680)">
    <rect x="0" y="0" width="300" height="90" class="box-output"/>
    <text x="150" y="25" text-anchor="middle" class="label" fill="#2e7d32">6. OUTPUT</text>
    <text x="150" y="48" text-anchor="middle" class="code" style="fill:#2e7d32">frame + metadata + health</text>
    <text x="150" y="65" text-anchor="middle" class="detail" fill="#2e7d32">→ Pre-process / Engine 1</text>
    <rect x="110" y="72" width="80" height="14" class="badge" style="fill:#2e7d32"/>
    <text x="150" y="83" text-anchor="middle" class="badge-text">16 ms total</text>
</g>

</svg>
