<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1300" height="700" viewBox="0 0 1300 700">
<defs>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
        <feDropShadow dx="3" dy="3" stdDeviation="4" flood-opacity="0.15"/>
    </filter>
    
    <style>
        /* FONTS */
        text { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; fill: #212121; }
        .title { font-weight: 800; font-size: 22px; fill: #ffffff; }
        .subtitle { font-size: 14px; fill: #eceff1; }
        .label { font-weight: 700; font-size: 14px; fill: #000; }
        .detail { font-size: 11px; fill: #455a64; }
        .model { font-family: 'Consolas', 'Courier New', monospace; font-size: 10px; font-weight: 600; fill: #4a148c; }
        .param { font-family: 'Consolas', 'Courier New', monospace; font-size: 10px; fill: #6a1b9a; }
        
        /* BOXES */
        .box-main { fill: #f3e5f5; stroke: #4a148c; stroke-width: 3; filter: url(#shadow); rx: 12; }
        .box-federated { fill: #e0f2f1; stroke: #00695c; stroke-width: 2; filter: url(#shadow); rx: 8; }
        .box-governance { fill: #fff3e0; stroke: #ef6c00; stroke-width: 2; filter: url(#shadow); rx: 8; }
        .box-privacy { fill: #e8eaf6; stroke: #3f51b5; stroke-width: 2; filter: url(#shadow); rx: 8; }
        
        /* COMMON */
        .arrow { stroke: #455a64; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
        
        .badge { fill: #263238; rx: 4; }
        .badge-async { fill: #4a148c; rx: 4; }
        .badge-text { font-size: 9px; font-weight: 700; fill: #fff; font-family: 'Consolas', monospace; }
    </style>
    
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="#546e7a"/>
    </marker>
</defs>

<!-- HEADER -->
<rect x="0" y="0" width="1300" height="70" fill="#4a148c"/>
<text x="650" y="35" text-anchor="middle" class="title">LAYER 4: META-COGNITION &amp; FEDERATED PRIVACY</text>
<text x="650" y="55" text-anchor="middle" class="subtitle">Fleet Orchestration • ISO 26262 Governance • GDPR Privacy • Async (no real-time impact)</text>

<!-- MAIN CONTAINER -->
<rect x="30" y="85" width="1240" height="570" class="box-main"/>

<!-- INPUT -->
<g transform="translate(50, 110)">
    <rect x="0" y="0" width="150" height="200" fill="#fff" stroke="#455a64" stroke-width="2" rx="6" filter="url(#shadow)"/>
    <text x="75" y="25" text-anchor="middle" class="label">FROM ENGINES</text>
    <text x="75" y="50" text-anchor="middle" class="model">ttc_result</text>
    <text x="75" y="70" text-anchor="middle" class="model">risk_scores</text>
    <text x="75" y="90" text-anchor="middle" class="model">tracks[]</text>
    <text x="75" y="110" text-anchor="middle" class="model">predictions[]</text>
    <text x="75" y="135" text-anchor="middle" class="param">validation_status</text>
    <text x="75" y="155" text-anchor="middle" class="param">hardware_state</text>
</g>

<!-- ARROW -->
<line x1="200" y1="210" x2="250" y2="210" class="arrow"/>

<!-- FEDERATED ORCHESTRATION -->
<g transform="translate(250, 110)">
    <rect x="0" y="0" width="300" height="230" class="box-federated"/>
    <text x="150" y="25" text-anchor="middle" class="label" fill="#00695c">FEDERATED ORCHESTRATION</text>
    
    <g transform="translate(15, 45)">
        <rect x="0" y="0" width="270" height="50" rx="4" fill="#fff" stroke="#00695c"/>
        <text x="135" y="18" text-anchor="middle" class="model" style="fill:#00695c">Fleet Sync (UDP)</text>
        <text x="135" y="35" text-anchor="middle" class="param">Broadcast alerts to all nodes</text>
        <text x="135" y="48" text-anchor="middle" class="param">10-100ms interval</text>
    </g>
    
    <g transform="translate(15, 105)">
        <rect x="0" y="0" width="270" height="50" rx="4" fill="#fff" stroke="#00695c"/>
        <text x="135" y="18" text-anchor="middle" class="model" style="fill:#00695c">Distributed Learning</text>
        <text x="135" y="35" text-anchor="middle" class="param">Federated averaging</text>
        <text x="135" y="48" text-anchor="middle" class="param">Differential privacy ε=1.0</text>
    </g>
    
    <g transform="translate(15, 165)">
        <rect x="0" y="0" width="270" height="40" rx="4" fill="#e0f2f1" stroke="#00695c"/>
        <text x="135" y="15" text-anchor="middle" class="model" style="fill:#00695c">Multi-Camera Scaling</text>
        <text x="135" y="30" text-anchor="middle" class="param">Up to 1000 nodes</text>
    </g>
    
    <rect x="110" y="212" width="80" height="14" class="badge-async"/>
    <text x="150" y="223" text-anchor="middle" class="badge-text">ASYNC</text>
</g>

<!-- SAFETY GOVERNANCE -->
<g transform="translate(580, 110)">
    <rect x="0" y="0" width="300" height="230" class="box-governance"/>
    <text x="150" y="25" text-anchor="middle" class="label" fill="#ef6c00">SAFETY GOVERNANCE</text>
    
    <g transform="translate(15, 45)">
        <rect x="0" y="0" width="270" height="50" rx="4" fill="#fff" stroke="#ef6c00"/>
        <text x="135" y="18" text-anchor="middle" class="model" style="fill:#ef6c00">Traceability Log</text>
        <text x="135" y="35" text-anchor="middle" class="param">Every decision recorded</text>
        <text x="135" y="48" text-anchor="middle" class="param">timestamp, inputs, rationale</text>
    </g>
    
    <g transform="translate(15, 105)">
        <rect x="0" y="0" width="270" height="50" rx="4" fill="#fff" stroke="#ef6c00"/>
        <text x="135" y="18" text-anchor="middle" class="model" style="fill:#ef6c00">ISO 26262 ASIL-D</text>
        <text x="135" y="35" text-anchor="middle" class="param">Fail-safe / Fail-operational</text>
        <text x="135" y="48" text-anchor="middle" class="param">Cryptographic signatures</text>
    </g>
    
    <g transform="translate(15, 165)">
        <rect x="0" y="0" width="270" height="40" rx="4" fill="#fff3e0" stroke="#ef6c00"/>
        <text x="135" y="15" text-anchor="middle" class="model" style="fill:#ef6c00">Audit Export</text>
        <text x="135" y="30" text-anchor="middle" class="param">365 days retention, 100GB</text>
    </g>
    
    <rect x="110" y="212" width="80" height="14" class="badge-async"/>
    <text x="150" y="223" text-anchor="middle" class="badge-text">ASYNC</text>
</g>

<!-- PRIVACY & SECURITY -->
<g transform="translate(910, 110)">
    <rect x="0" y="0" width="300" height="230" class="box-privacy"/>
    <text x="150" y="25" text-anchor="middle" class="label" fill="#3f51b5">PRIVACY &amp; SECURITY</text>
    
    <g transform="translate(15, 45)">
        <rect x="0" y="0" width="270" height="50" rx="4" fill="#fff" stroke="#3f51b5"/>
        <text x="135" y="18" text-anchor="middle" class="model" style="fill:#3f51b5">On-Chip Anonymization</text>
        <text x="135" y="35" text-anchor="middle" class="param">SMPL avatar (no face/clothes)</text>
        <text x="135" y="48" text-anchor="middle" class="param">License plate masking</text>
    </g>
    
    <g transform="translate(15, 105)">
        <rect x="0" y="0" width="270" height="50" rx="4" fill="#fff" stroke="#3f51b5"/>
        <text x="135" y="18" text-anchor="middle" class="model" style="fill:#3f51b5">GDPR Compliance</text>
        <text x="135" y="35" text-anchor="middle" class="param">No PII stored or transmitted</text>
        <text x="135" y="48" text-anchor="middle" class="param">TLS 1.3, AES-256-GCM</text>
    </g>
    
    <g transform="translate(15, 165)">
        <rect x="0" y="0" width="270" height="40" rx="4" fill="#e8eaf6" stroke="#3f51b5"/>
        <text x="135" y="15" text-anchor="middle" class="model" style="fill:#3f51b5">Byzantine Tolerant</text>
        <text x="135" y="30" text-anchor="middle" class="param">Krum aggregation for security</text>
    </g>
    
    <rect x="110" y="212" width="80" height="14" class="badge-async"/>
    <text x="150" y="223" text-anchor="middle" class="badge-text">ASYNC</text>
</g>

<!-- OUTPUTS -->
<g transform="translate(250, 370)">
    <rect x="0" y="0" width="960" height="100" fill="#fff" stroke="#4a148c" stroke-width="2" rx="6" filter="url(#shadow)"/>
    <text x="480" y="25" text-anchor="middle" class="label" fill="#4a148c">OUTPUTS (All Async)</text>
    
    <rect x="30" y="45" width="200" height="40" rx="4" fill="#e0f2f1" stroke="#00695c"/>
    <text x="130" y="70" text-anchor="middle" class="model" style="fill:#00695c">Fleet Status + Alerts</text>
    
    <rect x="260" y="45" width="200" height="40" rx="4" fill="#fff3e0" stroke="#ef6c00"/>
    <text x="360" y="70" text-anchor="middle" class="model" style="fill:#ef6c00">Audit Trail (ISO)</text>
    
    <rect x="490" y="45" width="200" height="40" rx="4" fill="#e8eaf6" stroke="#3f51b5"/>
    <text x="590" y="70" text-anchor="middle" class="model" style="fill:#3f51b5">Anon Data Streams</text>
    
    <rect x="720" y="45" width="200" height="40" rx="4" fill="#f3e5f5" stroke="#4a148c"/>
    <text x="820" y="70" text-anchor="middle" class="model">Model Updates</text>
</g>

<!-- LEGEND -->
<g transform="translate(50, 550)">
    <text x="0" y="15" class="label">COMPONENTS:</text>
    <rect x="120" y="3" width="18" height="18" class="box-federated"/>
    <text x="145" y="17" class="detail">Federated</text>
    <rect x="220" y="3" width="18" height="18" class="box-governance"/>
    <text x="245" y="17" class="detail">Governance</text>
    <rect x="330" y="3" width="18" height="18" class="box-privacy"/>
    <text x="355" y="17" class="detail">Privacy</text>
    
    <rect x="450" y="3" width="18" height="18" class="badge-async"/>
    <text x="480" y="17" class="detail" fill="#4a148c">= Async (no latency impact)</text>
</g>

<!-- COMPLIANCE BADGES -->
<g transform="translate(900, 550)">
    <rect x="0" y="0" width="70" height="25" rx="4" fill="#2e7d32"/>
    <text x="35" y="17" text-anchor="middle" class="badge-text">GDPR ✓</text>
    
    <rect x="80" y="0" width="100" height="25" rx="4" fill="#ef6c00"/>
    <text x="130" y="17" text-anchor="middle" class="badge-text">ISO 26262 ✓</text>
    
    <rect x="190" y="0" width="100" height="25" rx="4" fill="#3f51b5"/>
    <text x="240" y="17" text-anchor="middle" class="badge-text">EN 50129 ✓</text>
</g>

</svg>
