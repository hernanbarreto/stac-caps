<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="700" viewBox="0 0 1200 700">
<defs>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
        <feDropShadow dx="3" dy="3" stdDeviation="4" flood-opacity="0.15"/>
    </filter>
    
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="#546e7a"/>
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="#d32f2f"/>
    </marker>

    <style>
        /* FONTS */
        text { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; fill: #212121; }
        .title { font-weight: 800; font-size: 22px; fill: #ffffff; }
        .subtitle { font-size: 14px; fill: #eceff1; }
        .label { font-weight: 700; font-size: 14px; fill: #000; }
        .detail { font-size: 11px; fill: #455a64; }
        .model { font-family: 'Consolas', 'Courier New', monospace; font-size: 10px; font-weight: 600; fill: #455a64; }
        .param { font-family: 'Consolas', 'Courier New', monospace; font-size: 10px; fill: #546e7a; }
        
        /* BOXES */
        .box-main { fill: #e8f5e9; stroke: #2e7d32; stroke-width: 3; filter: url(#shadow); rx: 12; }
        .box-can { fill: #ffebee; stroke: #d32f2f; stroke-width: 2; filter: url(#shadow); rx: 8; }
        .box-mqtt { fill: #e3f2fd; stroke: #1565c0; stroke-width: 2; filter: url(#shadow); rx: 8; }
        .box-scada { fill: #fff3e0; stroke: #ef6c00; stroke-width: 2; filter: url(#shadow); rx: 8; }
        .box-audit { fill: #f1f8e9; stroke: #33691e; stroke-width: 2; filter: url(#shadow); rx: 8; }
        .box-input { fill: #ffffff; stroke: #455a64; stroke-width: 2; filter: url(#shadow); rx: 8; }
        
        /* COMMON */
        .arrow { stroke: #455a64; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
        .arrow-critical { stroke: #d32f2f; stroke-width: 3; fill: none; marker-end: url(#arrowhead-red); }
        
        .badge { fill: #263238; rx: 4; }
        .badge-text { font-size: 9px; font-weight: 700; fill: #fff; font-family: 'Consolas', monospace; }
    </style>
</defs>

<!-- HEADER -->
<rect x="0" y="0" width="1200" height="70" fill="#455a64"/>
<text x="600" y="35" text-anchor="middle" class="title">LAYER 6: OUTPUT INTERFACE</text>
<text x="600" y="55" text-anchor="middle" class="subtitle">CAN Bus • SCADA • MQTT • Audit Trail • Priority Routing</text>

<!-- MAIN CONTAINER -->
<rect x="30" y="85" width="1140" height="580" class="box-main"/>

<!-- INPUT: Safety Decision -->
<g transform="translate(50, 230)">
    <rect x="0" y="0" width="200" height="150" class="box-input"/>
    <text x="100" y="25" text-anchor="middle" class="label">FROM LAYER 5</text>
    <text x="100" y="45" text-anchor="middle" class="model">SafetyDecision</text>
    <text x="100" y="65" text-anchor="middle" class="param">action, ttc, risk</text>
    <text x="100" y="80" text-anchor="middle" class="param">target_id, distance</text>
    <line x1="20" y1="95" x2="180" y2="95" stroke="#455a64"/>
    <text x="100" y="115" text-anchor="middle" class="model">TelemetryPacket</text>
    <text x="100" y="130" text-anchor="middle" class="param">tracks, fps, health</text>
</g>

<!-- ARROWS TO OUTPUT MANAGER -->
<line x1="250" y1="305" x2="330" y2="305" class="arrow"/>

<!-- OUTPUT MANAGER (center) -->
<g transform="translate(330, 170)">
    <rect x="0" y="0" width="220" height="320" fill="#fff" stroke="#455a64" stroke-width="3" rx="10" filter="url(#shadow)"/>
    <text x="110" y="30" text-anchor="middle" class="label">OUTPUT MANAGER</text>
    
    <rect x="20" y="50" width="180" height="40" rx="4" fill="#eceff1" stroke="#455a64"/>
    <text x="110" y="75" text-anchor="middle" class="model">Priority Queue</text>
    
    <rect x="20" y="100" width="180" height="40" rx="4" fill="#f1f8e9" stroke="#33691e"/>
    <text x="110" y="125" text-anchor="middle" class="model" style="fill:#33691e">Traceability Hasher</text>
    
    <rect x="20" y="150" width="180" height="40" rx="4" fill="#eceff1" stroke="#455a64"/>
    <text x="110" y="175" text-anchor="middle" class="model">Message Serializer</text>
    
    <rect x="20" y="200" width="180" height="40" rx="4" fill="#eceff1" stroke="#455a64"/>
    <text x="110" y="225" text-anchor="middle" class="model">Channel Router</text>
    
    <rect x="20" y="250" width="180" height="40" rx="4" fill="#eceff1" stroke="#455a64"/>
    <text x="110" y="275" text-anchor="middle" class="model">Fallback Handler</text>
</g>

<!-- ARROWS TO CHANNELS -->
<line x1="550" y1="210" x2="650" y2="145" class="arrow-critical"/>
<line x1="550" y1="280" x2="650" y2="280" class="arrow"/>
<line x1="550" y1="350" x2="650" y2="350" class="arrow"/>
<line x1="550" y1="420" x2="650" y2="490" class="arrow"/>

<!-- CAN BUS CHANNEL -->
<g transform="translate(650, 100)">
    <rect x="0" y="0" width="230" height="100" class="box-can"/>
    <text x="115" y="25" text-anchor="middle" class="label" fill="#d32f2f">CAN BUS + GPIO</text>
    <rect x="80" y="35" width="70" height="15" class="badge" style="fill:#d32f2f"/>
    <text x="115" y="46" text-anchor="middle" class="badge-text">PRIORITY 0</text>
    
    <text x="115" y="70" text-anchor="middle" class="model" style="fill:#d32f2f">EMERGENCY_BRAKE</text>
    <text x="115" y="85" text-anchor="middle" class="param" style="fill:#d32f2f">Latency: &lt;1ms</text>
</g>

<!-- SCADA CHANNEL -->
<g transform="translate(650, 220)">
    <rect x="0" y="0" width="230" height="100" class="box-scada"/>
    <text x="115" y="25" text-anchor="middle" class="label" fill="#ef6c00">SCADA / OPC-UA</text>
    <rect x="80" y="35" width="70" height="15" class="badge" style="fill:#ef6c00"/>
    <text x="115" y="46" text-anchor="middle" class="badge-text">PRIORITY 2</text>
    
    <text x="115" y="70" text-anchor="middle" class="model" style="fill:#ef6c00">Operations Center</text>
    <text x="115" y="85" text-anchor="middle" class="param" style="fill:#ef6c00">Latency: &lt;100ms</text>
</g>

<!-- MQTT CHANNEL -->
<g transform="translate(650, 340)">
    <rect x="0" y="0" width="230" height="100" class="box-mqtt"/>
    <text x="115" y="25" text-anchor="middle" class="label" fill="#1565c0">MQTT PUB/SUB</text>
    <rect x="80" y="35" width="70" height="15" class="badge" style="fill:#1565c0"/>
    <text x="115" y="46" text-anchor="middle" class="badge-text">PRIORITY 3</text>
    
    <text x="115" y="70" text-anchor="middle" class="model" style="fill:#1565c0">Fleet + Cloud</text>
    <text x="115" y="85" text-anchor="middle" class="param" style="fill:#1565c0">QoS 2, TLS 1.3</text>
</g>

<!-- AUDIT CHANNEL -->
<g transform="translate(650, 460)">
    <rect x="0" y="0" width="230" height="100" class="box-audit"/>
    <text x="115" y="25" text-anchor="middle" class="label" fill="#2e7d32">AUDIT LOGGER</text>
    <rect x="80" y="35" width="70" height="15" class="badge" style="fill:#2e7d32"/>
    <text x="115" y="46" text-anchor="middle" class="badge-text">ASYNC</text>
    
    <text x="115" y="70" text-anchor="middle" class="model" style="fill:#2e7d32">Signed JSON Logs</text>
    <text x="115" y="85" text-anchor="middle" class="param" style="fill:#2e7d32">File + Cloud backup</text>
</g>

<!-- OUTPUT DESTINATIONS -->
<line x1="880" y1="150" x2="950" y2="150" class="arrow-critical"/>
<line x1="880" y1="270" x2="950" y2="270" class="arrow"/>
<line x1="880" y1="390" x2="950" y2="390" class="arrow"/>
<line x1="880" y1="510" x2="950" y2="510" class="arrow"/>

<g transform="translate(950, 115)">
    <rect x="0" y="0" width="180" height="70" rx="6" fill="#ffebee" stroke="#d32f2f" stroke-width="2"/>
    <text x="90" y="25" text-anchor="middle" class="label" fill="#d32f2f">Train Control</text>
    <text x="90" y="45" text-anchor="middle" class="model" style="fill:#d32f2f">Brake Actuator</text>
    <text x="90" y="60" text-anchor="middle" class="param" style="fill:#d32f2f">+ Emergency Relay</text>
</g>

<g transform="translate(950, 235)">
    <rect x="0" y="0" width="180" height="70" rx="6" fill="#fff3e0" stroke="#ef6c00" stroke-width="2"/>
    <text x="90" y="25" text-anchor="middle" class="label" fill="#ef6c00">OCC</text>
    <text x="90" y="45" text-anchor="middle" class="model" style="fill:#ef6c00">Operator Console</text>
    <text x="90" y="60" text-anchor="middle" class="param" style="fill:#ef6c00">Modbus / OPC-UA</text>
</g>

<g transform="translate(950, 355)">
    <rect x="0" y="0" width="180" height="70" rx="6" fill="#e3f2fd" stroke="#1565c0" stroke-width="2"/>
    <text x="90" y="25" text-anchor="middle" class="label" fill="#1565c0">Fleet Manager</text>
    <text x="90" y="45" text-anchor="middle" class="model" style="fill:#1565c0">Cloud Platform</text>
    <text x="90" y="60" text-anchor="middle" class="param" style="fill:#1565c0">Federated sync</text>
</g>

<g transform="translate(950, 475)">
    <rect x="0" y="0" width="180" height="70" rx="6" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2"/>
    <text x="90" y="25" text-anchor="middle" class="label" fill="#2e7d32">Audit Storage</text>
    <text x="90" y="45" text-anchor="middle" class="model" style="fill:#2e7d32">Immutable Logs</text>
    <text x="90" y="60" text-anchor="middle" class="param" style="fill:#2e7d32">Compliance ready</text>
</g>

<!-- TIMING BADGE -->
<g transform="translate(50, 580)">
    <rect x="0" y="0" width="100" height="30" class="badge"/>
    <text x="50" y="20" text-anchor="middle" class="badge-text">LAYER 6: 5ms</text>
</g>

</svg>
